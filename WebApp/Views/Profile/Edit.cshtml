@{
    Layout = "_DashboardLayout";
    ViewData["Title"] = "Edit Profile";
    
    var userAccount = ViewBag.UserAccount as WebApp.Models.UserAccount;
    var student = ViewBag.Student as WebApp.Models.Student;
    var instructor = ViewBag.Instructor as WebApp.Models.Instructor;
    var departments = ViewBag.Departments as List<WebApp.Models.Department> ?? new List<WebApp.Models.Department>();
}

<div class="profile-edit-container">
    <div class="profile-edit-header">
        <h1>Edit Profile</h1>
        <a asp-action="Index" class="btn btn-outline-secondary">‚Üê Back</a>
    </div>

    @if (TempData["ErrorMessage"] != null)
    {
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
            @TempData["ErrorMessage"]
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    }

    <form asp-action="Edit" method="post" class="profile-edit-form">
        @Html.AntiForgeryToken()

        <!-- User Account Section -->
        <div class="form-section">
            <h3>Account Information</h3>
            <div class="form-grid">
                <div class="form-group">
                    <label>Username</label>
                    <input type="text" class="form-control" value="@userAccount?.Username" disabled>
                    <small class="form-text text-muted">Username cannot be changed</small>
                </div>
                <div class="form-group">
                    <label>Email <span class="text-danger">*</span></label>
                    <input type="email" name="email" class="form-control" value="@userAccount?.Email" required>
                </div>
                <div class="form-group">
                    <label>Role</label>
                    <input type="text" class="form-control" value="@userAccount?.Role" disabled>
                    <small class="form-text text-muted">Role cannot be changed</small>
                </div>
            </div>
        </div>

        @if (student != null)
        {
            <!-- Student Section -->
            <div class="form-section">
                <h3>Student Information</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Student Code</label>
                        <input type="text" class="form-control" value="@student.StudentCode" disabled>
                        <small class="form-text text-muted">Student code cannot be changed</small>
                    </div>
                    <div class="form-group">
                        <label>Full Name <span class="text-danger">*</span></label>
                        <input type="text" name="studentFullName" class="form-control" value="@student.FullName" required>
                    </div>
                    <div class="form-group">
                        <label>Email <span class="text-danger">*</span></label>
                        <input type="email" name="studentEmail" class="form-control" value="@student.Email" required>
                    </div>
                    <div class="form-group">
                        <label>Major <span class="text-danger">*</span></label>
                        <input type="text" name="studentMajor" class="form-control" value="@student.Major" required>
                    </div>
                    <div class="form-group">
                        <label>Department</label>
                        <select name="studentDepartmentId" class="form-select">
                            <option value="">-- Select Department --</option>
                            @foreach (var dept in departments)
                            {
                                @if (student.DepartmentId == dept.Id)
                                {
                                    <option value="@dept.Id" selected>@dept.Name</option>
                                }
                                else
                                {
                                    <option value="@dept.Id">@dept.Name</option>
                                }
                            }
                        </select>
                    </div>
                    <div class="form-group">
                        <label>GPA</label>
                        <input type="text" class="form-control" value="@student.Gpa.ToString("0.00")" disabled>
                        <small class="form-text text-muted">GPA cannot be changed</small>
                    </div>
                    <div class="form-group">
                        <label>Total Credits</label>
                        <input type="text" class="form-control" value="@student.TotalCredits" disabled>
                        <small class="form-text text-muted">Total credits cannot be changed</small>
                    </div>
                </div>
            </div>
        }

        @if (instructor != null)
        {
            <!-- Instructor Section -->
            <div class="form-section">
                <h3>Instructor Information</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Full Name <span class="text-danger">*</span></label>
                        <input type="text" name="instructorFullName" class="form-control" value="@instructor.FullName" required>
                    </div>
                    <div class="form-group">
                        <label>Email <span class="text-danger">*</span></label>
                        <input type="email" name="instructorEmail" class="form-control" value="@instructor.Email" required>
                    </div>
                    <div class="form-group">
                        <label>Phone Number</label>
                        <input type="tel" name="instructorPhoneNumber" class="form-control" value="@instructor.PhoneNumber">
                    </div>
                    <div class="form-group">
                        <label>Department <span class="text-danger">*</span></label>
                        <select name="instructorDepartmentId" class="form-select" required>
                            <option value="">-- Select Department --</option>
                            @foreach (var dept in departments)
                            {
                                @if (instructor.DepartmentId == dept.Id)
                                {
                                    <option value="@dept.Id" selected>@dept.Name</option>
                                }
                                else
                                {
                                    <option value="@dept.Id">@dept.Name</option>
                                }
                            }
                        </select>
                    </div>
                </div>
            </div>
        }

        <div class="form-actions">
            <button type="submit" class="btn btn-primary btn-lg">
                <span>üíæ</span> Save Changes
            </button>
            <a asp-action="Index" class="btn btn-outline-secondary btn-lg">Cancel</a>
        </div>
    </form>
</div>

<style>
.profile-edit-container {
    max-width: 1000px;
    margin: 0 auto;
}

.profile-edit-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2rem;
}

.profile-edit-header h1 {
    font-size: 2rem;
    font-weight: 700;
    color: var(--text-dark);
    margin: 0;
}

.profile-edit-form {
    display: flex;
    flex-direction: column;
    gap: 2rem;
}

.form-section {
    background: #fff;
    border-radius: 16px;
    padding: 2rem;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
}

.form-section h3 {
    font-size: 1.5rem;
    font-weight: 600;
    margin: 0 0 1.5rem 0;
    color: var(--text-dark);
    padding-bottom: 1rem;
    border-bottom: 2px solid #e2e8f0;
}

.form-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 1.5rem;
}

.form-group {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.form-group label {
    font-size: 0.875rem;
    font-weight: 600;
    color: var(--text-dark);
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.form-group .form-control,
.form-group .form-select {
    padding: 0.75rem 1rem;
    border: 2px solid #e2e8f0;
    border-radius: 8px;
    font-size: 1rem;
    transition: all 0.2s;
}

.form-group .form-control:focus,
.form-group .form-select:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(47, 75, 244, 0.1);
}

.form-group .form-control:disabled {
    background-color: #f8f9fa;
    cursor: not-allowed;
}

.form-group .form-text {
    font-size: 0.875rem;
    color: var(--text-muted);
}

.form-actions {
    display: flex;
    gap: 1rem;
    justify-content: flex-end;
    padding-top: 1rem;
    border-top: 2px solid #e2e8f0;
}

.form-actions .btn {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 2rem;
    font-weight: 600;
    border-radius: 8px;
    transition: all 0.2s;
}

.form-actions .btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(47, 75, 244, 0.3);
}

.text-danger {
    color: #dc3545;
}
</style>

